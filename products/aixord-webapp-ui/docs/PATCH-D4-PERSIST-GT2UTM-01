HANDOFF 1
PATCH-D4-PERSIST-GT2UTM-01
Target: D4-CHAT_PROJECT_PLAN.md 

D4-CHAT_PROJECT_PLAN

1. Problem Statement (Evidence-Based)

From Test-issues.txt 

Test-issues

:

Confirmed Failures

Workspace binding reads files but does not persist artifacts

Scaffold shows “0 items” while folders exist

AI outputs are generated but not committed to disk

Session navigation does not allow reliable reopening

No visible Environment Awareness Report

No enforced artifact commit layer

No UI proof of artifact writes

Governance expected file persistence but tool path not invoked

This violates:

GA:ENV expectations (workspace binding)

Artifact lifecycle intent in project plan

L-SSC continuity expectations

Governance → UI traceability expectations (GT2UTM)

2. Root Cause Summary

From D4-CHAT plan 

D4-CHAT_PROJECT_PLAN

 and Test-issues 

Test-issues

:

A. Persistence Is Not Mandatory

Writer utilities exist:

fileSystem.ts

scaffoldGenerator.ts

But artifact writes are not enforced post-AI output.

B. No Artifact Commit Enforcement Layer

Execution ≠ File persistence
Chat completion ≠ State change

C. GT2UTM Gap

Governance artifacts (HANDOFF, STATE, Blueprint, DTL)
are not traceably mapped to UI write-confirmation events.

3. Required Structural Fixes
3.1 Add Mandatory Artifact Commit Layer

Create:

commitArtifactsToWorkspace(artifactBundle)

Requirements:

Validate binding_confirmed === true

Validate folder_name !== null

Ensure /aixord/ invariant directory exists

Write canonical artifacts:

STATE.json

ARTIFACTS/*

HANDOFF/*

AUDIT/*

BLUEPRINT/*

Return:

file paths

file sizes

sha256 hashes

timestamp

Enforcement Rule:

No phase transition allowed if:

artifact_commit_evidence.missing = true

3.2 Add Artifact Persistence Enforcement Gate (Non-New GA)

Not a new GA:*
Instead: attach to existing gates.

Trigger	Enforcement
Phase Finalize	Must verify artifact hashes exist
Session End	Must write HANDOFF
Blueprint Update	Must write BLUEPRINT artifact
AUDIT Entry	Must write DTL

If missing → UI badge:

⚠️ Artifact Not Persisted

3.3 Add EAR-01 (Environment Awareness Report)

One-click report that performs:

Write proof test

Read proof test

Hash compare

Artifact write test

Directory list verification

Binding metadata verification

Output:

aixord/AUDIT/EAR-01.json


Displayed in:
EvidenceRibbon → “Environment Health”

3.4 Fix Scaffold Status Reporting

Modify scaffold generator to return:

{
  "itemsWritten": 12,
  "pathsWritten": [...],
  "startedAt": "...",
  "endedAt": "..."
}


Persist to workspace_bindings metadata.
Refresh wizard summary screen.

Fixes “Scaffold: Generated (0 items)” bug.

3.5 Session Reopen Fix (Session Graph Alignment)

From plan 

D4-CHAT_PROJECT_PLAN

:

Sessions API exists but UI not first-class.

Required Behavior:

Persistent SessionList panel

URL parameter: ?session=<id>

“New Session” does not hide prior sessions

Chat header dropdown: Recent Sessions

This satisfies:

Project-level awareness

Non-isolated session model

GT2UTM continuity mapping

4. GT2UTM Mapping (Governance → UI)

Add table to Project Plan:

Governance Law	Backend Artifact	UI Confirmation
GA:ENV	workspace_binding	ENV Pill
GA:FLD	folder_name	FLD Pill
L-SSC	HANDOFF artifact	SessionList
L-AVL	DTL entry	Audit Ribbon
Artifact Commit	Hash Evidence	EvidenceRibbon
L-PS	Path validation	ErrorBoundary

This closes Formalize GT2UTM gap.

5. Acceptance Criteria

PATCH COMPLETE IF:

✓ AI output triggers artifact commit automatically

✓ Hash + path evidence visible

✓ EAR-01 passes

✓ Scaffold count correct

✓ Session reopening stable

✓ Phase transitions blocked if no artifact commit evidence

✓ GT2UTM table added to project plan

6. Outcome

After this patch:

D4-CHAT becomes:

Deterministic in artifact persistence

Observable in file writes

Traceable governance-to-UI

Session-aware at project level

Resistant to “AI talked but nothing committed” failure
