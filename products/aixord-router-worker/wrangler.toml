name = "aixord-router-worker"
main = "src/index.ts"
compatibility_date = "2025-01-01"

[vars]
ENVIRONMENT = "production"
AUTH_SALT = "aixord-d4-backend-salt-2026"

# GitHub OAuth (PATCH-GITHUB-01, PATCH-CORS-01)
GITHUB_REDIRECT_URI = "https://aixord-router-worker.peoplemerit.workers.dev/api/v1/github/callback"
FRONTEND_URL = "https://aixord.pmerit.com"

# Secrets (set via wrangler secret put):
# PLATFORM_ANTHROPIC_KEY
# PLATFORM_OPENAI_KEY
# PLATFORM_GOOGLE_KEY
# PLATFORM_DEEPSEEK_KEY
# STRIPE_SECRET_KEY
# STRIPE_WEBHOOK_SECRET
# GUMROAD_PRODUCT_ID
# KDP_CODE_SECRET
# GITHUB_CLIENT_ID
# GITHUB_CLIENT_SECRET
# GITHUB_TOKEN_ENCRYPTION_KEY
# RESEND_API_KEY - for transactional emails (verification, password reset)

# D1 Database binding (shared with webapp for subscription/usage data)
[[d1_databases]]
binding = "DB"
database_name = "aixord-db"
database_id = "4222a800-ec94-479b-94d2-f1beaa7d01d9"

# R2 Object Storage - Image Evidence (ENH-4: Path C)
[[r2_buckets]]
binding = "IMAGES"
bucket_name = "aixord-images"

# =============================================================================
# STAGING ENVIRONMENT
# =============================================================================
# Deploy: wrangler deploy --env staging
# Dev:    wrangler dev --env staging
# DB:     wrangler d1 migrations apply --env staging
[env.staging]
name = "aixord-router-worker-staging"

[env.staging.vars]
ENVIRONMENT = "staging"
AUTH_SALT = "aixord-d4-backend-salt-2026-staging"
GITHUB_REDIRECT_URI = "https://aixord-router-worker-staging.peoplemerit.workers.dev/api/v1/github/callback"
FRONTEND_URL = "https://staging.aixord.pmerit.com"

# Staging D1 Database
[[env.staging.d1_databases]]
binding = "DB"
database_name = "aixord-db-staging"
database_id = "e7604a7b-a496-4bc5-b7c1-8c1b8bf64ba9"

# Staging R2 Bucket (created via: wrangler r2 bucket create aixord-images-staging)
[[env.staging.r2_buckets]]
binding = "IMAGES"
bucket_name = "aixord-images-staging"
